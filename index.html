<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KAUÃ_OS // GEMINI_CANVAS_V10</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;600&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg: #050505;
            --panel: #0a0a0a;
            --border: #333;
            --accent: #00ff41;
            --text: #e0e0e0;
        }

        * { box-sizing: border-box; user-select: none; }
        
        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Share Tech Mono', monospace;
            height: 100vh; width: 100vw; overflow: hidden;
            margin: 0; display: flex; justify-content: center; align-items: center;
        }

        /* --- FX --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%; pointer-events: none; z-index: 10; opacity: 0.2;
        }

        /* --- MODALS (New File) --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 150;
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px);
        }
        .modal-box {
            background: #0f0f0f; border: 1px solid var(--accent); padding: 2px;
            width: 300px; box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
            display: flex; flex-direction: column;
        }
        .modal-header {
            background: var(--accent); color: black; font-weight: bold; padding: 5px 10px;
            text-transform: uppercase; font-size: 12px;
        }
        .modal-body { padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .lang-btn {
            background: #222; border: 1px solid #444; color: #ccc; padding: 8px;
            cursor: pointer; text-align: left; transition: 0.2s; font-size: 12px;
            display: flex; align-items: center; gap: 10px;
        }
        .lang-btn:hover { background: #333; border-color: var(--accent); color: white; }
        .modal-input {
            background: black; border: 1px solid #444; color: white; padding: 8px;
            font-family: 'Share Tech Mono'; outline: none;
        }

        /* --- IMMERSIVE CANVAS --- */
        #immersive-canvas {
            position: fixed; inset: 0; z-index: 100;
            background: #080808;
            display: none; flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .canvas-header {
            height: 50px; border-bottom: 1px solid #333;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; background: #0f0f0f;
        }

        .canvas-body { flex: 1; display: flex; overflow: hidden; }

        .code-pane {
            flex: 1; display: flex; flex-direction: column; border-right: 1px solid #333;
            background: #0b0b0b; min-width: 300px;
        }
        .preview-pane {
            flex: 1; display: flex; flex-direction: column;
            background: #1a1a1a; position: relative;
        }

        #editor-area {
            flex: 1; background: transparent; color: #d4d4d4; border: none; outline: none;
            padding: 20px; font-family: 'Fira Code', monospace; font-size: 14px; resize: none;
            line-height: 1.6; white-space: pre;
        }

        #web-preview { width: 100%; height: 100%; border: none; background: white; display: none; }
        #console-preview { 
            width: 100%; height: 100%; padding: 20px; 
            font-family: 'Fira Code', monospace; font-size: 14px; 
            color: var(--accent); overflow-y: auto; display: none;
        }

        /* --- DESKTOP GRID --- */
        #desktop-grid {
            display: grid; width: 100%; height: 100%; padding: 5px; gap: 5px;
            grid-template-columns: 250px 1fr 250px; 
            grid-template-rows: 40px 1fr 240px;
            transition: opacity 0.3s, filter 0.3s;
            opacity: 0; 
        }

        /* Mobile Layout */
        @media (max-width: 1024px) {
            #desktop-grid {
                grid-template-columns: 1fr;
                grid-template-rows: 40px 1fr 200px;
            }
            #p-left, #p-right, #p-files { display: none !important; }
            #p-header { grid-column: 1 !important; grid-row: 1 !important; }
            #p-center { grid-column: 1 !important; grid-row: 2 !important; }
            #p-keyboard { grid-column: 1 !important; grid-row: 3 !important; width: 100% !important; margin-left: 0 !important; }
            
            .canvas-body { flex-direction: column; }
            .code-pane { border-right: none; border-bottom: 1px solid #333; height: 50%; }
            .preview-pane { height: 50%; }
        }

        /* --- PANELS --- */
        .panel {
            background: var(--panel); border: 1px solid var(--border);
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }
        .panel-header {
            background: #111; padding: 4px 10px; font-size: 11px;
            text-transform: uppercase; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; color: #666;
        }

        /* --- UI ELEMENTS --- */
        .btn {
            background: #222; border: 1px solid #444; color: #ccc;
            padding: 6px 14px; font-size: 12px; cursor: pointer; transition: 0.2s;
            display: flex; items-center; gap: 5px; border-radius: 4px;
        }
        .btn:hover { background: #333; color: white; border-color: #666; }
        .btn-run { background: #14532d; border-color: #166534; color: #4ade80; }
        .btn-run:hover { background: #15803d; }

        .key { 
            background: #111; border: 1px solid #333; border-radius: 4px; 
            display:flex; justify-content:center; align-items:center; cursor:pointer; 
            font-size:12px; transition:0.05s; color:#666; 
        }
        /* Efeito visual da tecla corrigido */
        .key.active { background: #fff; color: black; box-shadow: 0 0 15px rgba(255,255,255,0.8); transform: translateY(1px); }

        #term-out { flex: 1; padding: 10px; overflow-y: auto; color: #ccc; font-size: 13px; }
        .cmd-line { color: white; font-weight: bold; margin-top: 5px; }

        /* START OVERLAY */
        #start-overlay {
            position: fixed; inset: 0; background: #000; z-index: 200;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .blink-text { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

    </style>
</head>
<body>

    <div class="scanlines"></div>

    <!-- START OVERLAY -->
    <div id="start-overlay" onclick="OS.boot()">
        <div class="text-3xl font-bold text-white mb-2 tracking-tighter">KAUÃ_OS <span class="text-xs text-green-500 bg-green-900/30 px-1 rounded">V10</span></div>
        <div class="text-xs text-gray-500 blink-text">CLICK TO INITIALIZE SYSTEM</div>
    </div>

    <!-- NEW FILE MODAL -->
    <div id="new-file-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">NOVO ARQUIVO</div>
            <div class="modal-body">
                <input type="text" id="new-filename" class="modal-input" placeholder="Nome do arquivo (sem extensão)">
                <div class="text-xs text-gray-500 mt-2">SELECIONE A LINGUAGEM:</div>
                <button class="lang-btn" onclick="OS.createFile('html')"><i data-lucide="globe" class="w-4 h-4 text-orange-400"></i> HTML5 (Web)</button>
                <button class="lang-btn" onclick="OS.createFile('python')"><i data-lucide="terminal" class="w-4 h-4 text-blue-400"></i> PYTHON 3</button>
                <button class="lang-btn" onclick="OS.createFile('java')"><i data-lucide="coffee" class="w-4 h-4 text-red-400"></i> JAVA</button>
                <button class="lang-btn" onclick="OS.createFile('cpp')"><i data-lucide="code-2" class="w-4 h-4 text-blue-600"></i> C++</button>
                <button class="lang-btn" onclick="OS.createFile('csharp')"><i data-lucide="hash" class="w-4 h-4 text-purple-400"></i> C#</button>
                <button class="lang-btn" style="border-color: #991b1b; color: #f87171;" onclick="document.getElementById('new-file-modal').style.display='none'">CANCELAR</button>
            </div>
        </div>
    </div>

    <!-- IMMERSIVE CANVAS (GEMINI STYLE) -->
    <div id="immersive-canvas">
        <div class="canvas-header">
            <div class="flex items-center gap-3">
                <div class="p-1 bg-green-900 rounded border border-green-700">
                    <i data-lucide="terminal" class="w-4 h-4 text-green-400"></i>
                </div>
                <div>
                    <div class="text-sm font-bold text-white tracking-wide" id="canvas-filename">UNTITLED</div>
                    <div class="text-[10px] text-gray-500">DEV ENVIRONMENT</div>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <button class="btn btn-run" onclick="Canvas.run()">
                    <i data-lucide="play" class="w-3 h-3"></i> <span class="hidden md:inline">RODAR CÓDIGO</span>
                </button>
                <button class="btn" onclick="Canvas.close()">
                    <i data-lucide="x" class="w-3 h-3"></i> FECHAR
                </button>
            </div>
        </div>

        <div class="canvas-body">
            <div class="code-pane">
                <textarea id="editor-area" spellcheck="false" placeholder="// Escreva seu código aqui..."></textarea>
            </div>
            <div class="preview-pane">
                <iframe id="web-preview"></iframe>
                <div id="console-preview">
                    <div class="opacity-50 mb-2">// CONSOLE OUTPUT</div>
                    <div id="console-logs"></div>
                </div>
                <div class="absolute top-2 right-2 px-2 py-1 bg-black/50 text-[10px] text-gray-400 border border-white/10 rounded">PREVIEW</div>
            </div>
        </div>
    </div>

    <!-- DESKTOP GRID -->
    <div id="desktop-grid">
        <!-- HEADER -->
        <div class="panel" id="p-header" style="grid-column: 1 / -1; grid-row: 1;">
            <div class="flex items-center justify-between h-full px-4">
                <div class="font-bold text-lg text-white flex gap-2 items-center">
                    KAUÃ_OS <span class="text-[10px] bg-green-900 px-1 rounded text-green-300">V10</span>
                </div>
                <div class="flex gap-4 items-center">
                    <div id="clock" class="text-sm font-mono text-gray-400">00:00</div>
                </div>
            </div>
        </div>

        <!-- LEFT -->
        <div class="panel" id="p-left" style="grid-column: 1; grid-row: 2 / 4;">
            <div class="panel-header">STATUS</div>
            <div class="p-4 flex flex-col gap-4">
                <canvas id="cpu-chart" class="w-full h-24 border border-gray-800 bg-black"></canvas>
                <div class="text-xs text-gray-400">CPU LOAD: <span id="cpu-val" class="text-green-400">12%</span></div>
            </div>
        </div>

        <!-- CENTER (TERMINAL) -->
        <div class="panel" id="p-center" style="grid-column: 2; grid-row: 2;">
            <div class="panel-header">TERMINAL</div>
            <div id="term-out"></div>
            <div class="bg-black p-2 flex items-center border-t border-[#333]">
                <span class="text-green-500 mr-2 font-bold">root@kaua:~$</span>
                <input id="cmd-input" type="text" class="bg-transparent border-none outline-none text-white flex-1 font-mono" autocomplete="off">
            </div>
        </div>

        <!-- RIGHT (GLOBE) -->
        <div class="panel" id="p-right" style="grid-column: 3; grid-row: 2;">
            <div class="panel-header">REDE</div>
            <div class="flex-1 bg-black flex items-center justify-center relative">
                <canvas id="globe-canvas"></canvas>
                <div class="absolute bottom-2 right-2 text-[9px] text-gray-500">CONN: ENCRYPTED</div>
            </div>
        </div>

        <!-- FILES -->
        <div class="panel" id="p-files" style="grid-column: 2; grid-row: 3; width: 40%; float: left; margin-right: 5px;">
            <div class="panel-header">
                <span>ARQUIVOS</span>
                <button onclick="document.getElementById('new-file-modal').style.display='flex'" class="text-[9px] hover:text-green-400 cursor-pointer">[NEW FILE]</button>
            </div>
            <div id="file-grid" class="p-2 grid grid-cols-4 gap-2 content-start overflow-y-auto h-full"></div>
        </div>

        <!-- KEYBOARD -->
        <div class="panel" id="p-keyboard" style="grid-column: 2 / 4; grid-row: 3; width: auto; margin-left: 41%;">
            <div class="panel-header">INPUT</div>
            <div id="kb-container" class="p-2 h-full flex flex-col justify-center gap-1"></div>
        </div>
    </div>

    <script>
        // --- AUDIO SYSTEM ---
        const AudioSys = {
            ctx: null,
            init() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },
            play(type) {
                if (!this.ctx) this.init();
                if (this.ctx.state === 'suspended') this.ctx.resume();
                
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                const now = this.ctx.currentTime;
                
                if (type === 'click') {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(800, now);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                    osc.start(now); osc.stop(now + 0.05);
                } else if (type === 'enter') {
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(400, now);
                    osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.1);
                    osc.start(now); osc.stop(now + 0.1);
                }
            }
        };

        // --- FILE SYSTEM ---
        const FS = {
            files: {
                'welcome.html': { type: 'web', content: '<h1>Bem-vindo ao KAUÃ_OS</h1><p>Clique em [NEW FILE] para começar.</p>' }
            },
            addFile(name, type, content) {
                this.files[name] = { type, content };
                UI.renderFiles();
            }
        };

        // --- OS LOGIC ---
        const OS = {
            boot() {
                document.getElementById('start-overlay').style.display = 'none';
                document.getElementById('desktop-grid').style.opacity = '1';
                AudioSys.init(); AudioSys.play('enter');
                UI.init();
                Term.print("Sistema Inicializado.", "text-green-500");
            },
            createFile(lang) {
                const nameInput = document.getElementById('new-filename');
                let name = nameInput.value.trim();
                if(!name) name = "untitled";
                
                let ext = "", type = "console", content = "";
                
                switch(lang) {
                    case 'html': 
                        ext = ".html"; type = "web"; 
                        content = "<h1>Novo Site</h1>\n<button onclick='alert(\"Funciona!\")'>Clique</button>"; 
                        break;
                    case 'python': 
                        ext = ".py"; type = "console"; 
                        content = "print('Executando Python...')\nval = 10 + 20\nprint('Resultado: ' + str(val))"; 
                        break;
                    case 'java': 
                        ext = ".java"; type = "console"; 
                        content = "public class Main {\n  public static void main(String[] args) {\n    System.out.println('Executando Java...');\n  }\n}"; 
                        break;
                    case 'cpp': 
                        ext = ".cpp"; type = "console"; 
                        content = "#include <iostream>\nusing namespace std;\nint main() {\n  cout << 'Executando C++...' << endl;\n  return 0;\n}"; 
                        break;
                    case 'csharp': 
                        ext = ".cs"; type = "console"; 
                        content = "using System;\nclass Program {\n  static void Main() {\n    Console.WriteLine('Executando C#...');\n  }\n}"; 
                        break;
                }
                
                FS.addFile(name + ext, type, content);
                document.getElementById('new-file-modal').style.display = 'none';
                nameInput.value = "";
                Canvas.open(name + ext);
            }
        };

        // --- CANVAS (GEMINI STYLE) ---
        const Canvas = {
            el: document.getElementById('immersive-canvas'),
            editor: document.getElementById('editor-area'),
            web: document.getElementById('web-preview'),
            console: document.getElementById('console-preview'),
            logs: document.getElementById('console-logs'),
            currentFile: null,

            open(filename) {
                const file = FS.files[filename];
                if (!file) return Term.print("Arquivo não encontrado.", "text-red-500");
                
                this.currentFile = filename;
                document.getElementById('canvas-filename').innerText = filename.toUpperCase();
                this.editor.value = file.content;
                this.el.style.display = 'flex';
                document.getElementById('desktop-grid').style.filter = "blur(5px)";

                if (file.type === 'web') {
                    this.web.style.display = 'block';
                    this.console.style.display = 'none';
                    this.runWeb();
                } else {
                    this.web.style.display = 'none';
                    this.console.style.display = 'block';
                    this.logs.innerHTML = "<div class='text-gray-500'>Pronto para executar...</div>";
                }
                AudioSys.play('enter');
            },
            close() {
                this.el.style.display = 'none';
                document.getElementById('desktop-grid').style.filter = "none";
                if(this.currentFile) FS.files[this.currentFile].content = this.editor.value;
            },
            run() {
                AudioSys.play('enter');
                const content = this.editor.value;
                const file = FS.files[this.currentFile];
                file.content = content; // Auto-save

                if (file.type === 'web') this.runWeb();
                else this.runConsole(content);
            },
            runWeb() {
                this.web.srcdoc = this.editor.value;
            },
            runConsole(code) {
                this.logs.innerHTML = "";
                const lines = code.split('\n');
                lines.forEach((line, i) => {
                    // Simulação de Output para várias linguagens
                    let out = null;
                    // Python
                    if (line.match(/print\s*\((.*)\)/)) out = line.match(/print\s*\((.*)\)/)[1];
                    // Java / C#
                    else if (line.match(/(System\.out\.println|Console\.WriteLine)\s*\((.*)\)/)) out = line.match(/(System\.out\.println|Console\.WriteLine)\s*\((.*)\)/)[2];
                    // C++
                    else if (line.match(/cout\s*<<\s*(.*)/)) out = line.match(/cout\s*<<\s*(.*)/)[1].replace('<< endl', '').replace(';', '');

                    if (out) {
                        out = out.replace(/["']/g, ''); // Remove aspas
                        setTimeout(() => {
                            const d = document.createElement('div');
                            d.className = "text-green-400 mb-1 border-l-2 border-green-800 pl-2";
                            d.innerText = "> " + out;
                            this.logs.appendChild(d);
                        }, i * 200);
                    }
                });
                if(!this.logs.hasChildNodes()) {
                     this.logs.innerHTML = "<div class='text-yellow-500'>Compilação simulada concluída. (Sem saída detectada)</div>";
                }
            }
        };

        // --- UI & KEYBOARD FIX ---
        const UI = {
            init() {
                this.renderFiles();
                this.renderKeyboard();
                this.startGlobe();
            },
            renderFiles() {
                const g = document.getElementById('file-grid');
                g.innerHTML = '';
                Object.keys(FS.files).forEach(f => {
                    const div = document.createElement('div');
                    div.className = "flex flex-col items-center cursor-pointer hover:bg-white/10 p-2 rounded text-[10px] text-gray-400";
                    let icon = 'file-code';
                    if(f.endsWith('.html')) icon = 'globe';
                    else if(f.endsWith('.py') || f.endsWith('.java')) icon = 'terminal';
                    
                    div.innerHTML = `<i data-lucide="${icon}" class="mb-1 w-5 h-5"></i>${f}`;
                    div.onclick = () => Canvas.open(f);
                    g.appendChild(div);
                });
                lucide.createIcons();
            },
            renderKeyboard() {
                const k = document.getElementById('kb-container');
                const rows = ["1234567890", "QWERTYUIOP", "ASDFGHJKL", "ZXCVBNM"];
                k.innerHTML = '';
                rows.forEach(r => {
                    const d = document.createElement('div');
                    d.className = "flex justify-center gap-1 w-full mb-1";
                    r.split('').forEach(char => {
                        const key = document.createElement('div');
                        key.className = "key flex-1 h-8"; key.innerText = char;
                        key.dataset.key = char;
                        key.onmousedown = () => UI.triggerKey(char);
                        d.appendChild(key);
                    });
                    k.appendChild(d);
                });
                const sp = document.createElement('div'); sp.className="flex justify-center";
                sp.innerHTML=`<div class="key w-1/2 h-8" data-key="SPACE" onclick="UI.triggerKey(' ')">SPACE</div>`;
                k.appendChild(sp);
            },
            // FIX: Feedback visual garantido
            triggerKey(char) {
                const input = document.getElementById('cmd-input');
                const keyEl = document.querySelector(`.key[data-key="${char === ' ' ? 'SPACE' : char}"]`);
                
                if (keyEl) {
                    keyEl.classList.add('active');
                    setTimeout(() => keyEl.classList.remove('active'), 150);
                }
                
                input.value += char;
                input.focus();
                AudioSys.play('click');
            },
            startGlobe() {
                const cvs = document.getElementById('globe-canvas');
                const ctx = cvs.getContext('2d');
                let t = 0;
                function loop() {
                    if(!cvs.parentElement) return;
                    cvs.width = cvs.parentElement.offsetWidth;
                    cvs.height = cvs.parentElement.offsetHeight;
                    ctx.fillStyle = 'black'; ctx.fillRect(0,0,cvs.width,cvs.height);
                    t+=0.02;
                    ctx.fillStyle = '#00ff41';
                    const cx=cvs.width/2, cy=cvs.height/2;
                    for(let i=0; i<60; i++) {
                        const a = (i/60)*6.28 + t;
                        const x = Math.cos(a)*40; const y = Math.sin(a)*10;
                        ctx.beginPath(); ctx.arc(cx+x, cy+y, 1.5, 0, 6.28); ctx.fill();
                    }
                    requestAnimationFrame(loop);
                }
                loop();
            }
        };

        // --- TERMINAL ---
        const Term = {
            print(msg, cls='') {
                const d = document.createElement('div'); d.className=cls; d.innerHTML=msg;
                const out = document.getElementById('term-out');
                out.appendChild(d); out.scrollTop = out.scrollHeight;
            }
        };

        // --- EVENTS ---
        document.getElementById('cmd-input').addEventListener('keydown', e => {
            if(e.key === 'Enter') {
                const val = e.target.value.trim();
                Term.print(`root@kaua:~$ ${val}`, 'cmd-line');
                const cmd = val.split(' ');
                if(cmd[0] === 'code' && cmd[1]) Canvas.open(cmd[1]);
                else if(cmd[0] === 'ls') Object.keys(FS.files).forEach(f => Term.print(f, 'text-blue-400'));
                else if(cmd[0] === 'clear') document.getElementById('term-out').innerHTML = '';
                else Term.print("Comando inválido.", "text-gray-500");
                e.target.value = '';
                AudioSys.play('enter');
            } else {
                // Feedback visual ao digitar no teclado físico
                const char = e.key.toUpperCase();
                const keyEl = document.querySelector(`.key[data-key="${char === ' ' ? 'SPACE' : char}"]`);
                if (keyEl) {
                    keyEl.classList.add('active');
                    setTimeout(() => keyEl.classList.remove('active'), 150);
                }
                AudioSys.play('click');
            }
        });

        // Loop Stats
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
            document.getElementById('cpu-val').innerText = Math.floor(Math.random()*30+10)+"%";
        }, 1000);

    </script>
</body>
</html>
